<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Game Controller</title>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: white; font-family: 'Hind Siliguri', sans-serif; padding: 20px; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { display: flex; align-items: center; border-bottom: 1px solid #333; padding-bottom: 15px; margin-bottom: 20px; }
        .back-btn { text-decoration: none; color: #aaa; font-size: 1.2rem; margin-right: 15px; }
        h2 { margin: 0; color: #00ff00; font-family: 'Orbitron', sans-serif; }
        .card { background: #111; border: 1px solid #333; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        h3 { color: #00f2ff; margin-top: 0; border-bottom: 1px solid #222; padding-bottom: 10px; }
        label { display: block; color: #ccc; margin-top: 15px; font-size: 1rem; font-weight: bold; }
        input { width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: white; border-radius: 5px; margin-top: 5px; box-sizing: border-box; text-align: center; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 20px; font-family: 'Hind Siliguri', sans-serif; transition: 0.3s; font-size: 1rem; }
        .btn:hover { transform: scale(1.02); }
        .btn-purple { background: #9d00ff; color: white; }
        .btn-green { background: #00ff00; color: black; }
        .btn-red { background: #ff0055; color: white; margin-top: 10px; }
        .stock-info { background: rgba(157, 0, 255, 0.1); border: 1px solid #9d00ff; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 15px; }
        .stock-count { font-size: 2.5rem; font-family: 'Orbitron'; color: #d48aff; font-weight: bold; }
        
        /* Time Grid */
        .time-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <a href="home.html" class="back-btn">‚¨Ö Dashboard</a>
            <h2>GAME CONTROLLER</h2>
        </div>

        <!-- Stock Section -->
        <div class="card" style="border-top: 3px solid #9d00ff;">
            <h3>üìö ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï (Question Stock)</h3>
            <div class="stock-info">
                <span>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶∏‡ßç‡¶ü‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ü‡¶õ‡ßá</span>
                <div class="stock-count" id="q-stock">Loading...</div>
            </div>
            <label>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ü‡¶™‡¶≤‡ßã‡¶° (JSON):</label>
            <input type="file" id="json-file" accept=".json">
            <button class="btn btn-purple" onclick="uploadJSON()">Add Questions</button>
            <p id="upload-status" style="margin-top:10px; color: yellow; text-align: center;"></p>
            <button class="btn btn-red" onclick="clearStock()">üóëÔ∏è Clear Stock</button>
        </div>

        <!-- Game Settings -->
        <div class="card" style="border-top: 3px solid #00ff00;">
            <h3>‚öôÔ∏è ‡¶ó‡ßá‡¶Æ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ (Time & Limit)</h3>
            
            <!-- TIME SETTINGS (Start & End) -->
            <div class="time-grid">
                <div>
                    <label style="color: #00ff88;">üü¢ ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶∞ ‡¶∏‡¶Æ‡ßü (Start):</label>
                    <input type="datetime-local" id="start-time" style="color: #00ff88;">
                </div>
                <div>
                    <label style="color: #ff0055;">üî¥ ‡¶∂‡ßá‡¶∑‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü (End):</label>
                    <input type="datetime-local" id="end-time" style="color: #ff0055;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                <div style="grid-column: span 2;">
                    <label>üéØ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü (Limit):</label>
                    <input type="number" id="q-limit" placeholder="Example: 10">
                </div>
                <div>
                    <label>‡¶¶‡ßá‡¶ñ‡¶æ (Sec):</label>
                    <input type="number" id="view-time" placeholder="15">
                </div>
                <div>
                    <label>‡¶â‡¶§‡ßç‡¶§‡¶∞ (Sec):</label>
                    <input type="number" id="ans-time" placeholder="25">
                </div>
            </div>

            <button class="btn btn-green" onclick="saveConfig()">SAVE SETTINGS</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, update, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyBVwD0U7_QeX8EyOrZ4fm7OG_ow1b391-M", authDomain: "game-f739d.firebaseapp.com", databaseURL: "https://game-f739d-default-rtdb.firebaseio.com", projectId: "game-f739d", storageBucket: "game-f739d.firebasestorage.app", messagingSenderId: "744868437950", appId: "1:744868437950:web:622410843c8aeb229463ef" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        if(sessionStorage.getItem("admin_logged_in") !== "true") window.location.href = "login.html";

        const configRef = ref(db, 'settings/gameConfig');
        const manualQRef = ref(db, 'manualQuestions');

        // Load Settings
        onValue(configRef, (snap) => {
            const d = snap.val() || {};
            if(d.startTime) document.getElementById('start-time').value = d.startTime;
            if(d.endTime) document.getElementById('end-time').value = d.endTime; // Load End Time
            document.getElementById('q-limit').value = d.questionLimit || 10;
            document.getElementById('view-time').value = d.viewTime || 15;
            document.getElementById('ans-time').value = d.answerTime || 25;
        });

        onValue(manualQRef, (snap) => {
            const count = snap.exists() ? Object.keys(snap.val()).length : 0;
            document.getElementById('q-stock').innerText = count;
        });

        // Save Settings
        window.saveConfig = () => {
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const limit = parseInt(document.getElementById('q-limit').value);
            const view = parseInt(document.getElementById('view-time').value);
            const ans = parseInt(document.getElementById('ans-time').value);

            if(!startTime) return alert("Please set a Start Time!");

            update(configRef, {
                startTime: startTime,
                endTime: endTime, // Save End Time
                questionLimit: limit,
                viewTime: view,
                answerTime: ans
            }).then(() => alert("‚úÖ All Settings Saved!"));
        }

        window.uploadJSON = () => {
            const fileInput = document.getElementById('json-file');
            if(fileInput.files.length === 0) return alert("Select File!");
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const json = JSON.parse(e.target.result);
                    const updates = {};
                    json.forEach(q => { updates[push(manualQRef).key] = q; });
                    update(manualQRef, updates).then(() => { alert("Questions Added!"); fileInput.value = ''; });
                } catch(err) { alert("Invalid JSON!"); }
            };
            reader.readAsText(file);
        }

        window.clearStock = () => { if(confirm("Delete ALL Questions?")) remove(manualQRef); }
    </script>
</body>
</html>
