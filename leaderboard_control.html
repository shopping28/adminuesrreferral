<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>Leaderboard Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <style>
        body { background: #111; color: white; font-family: 'Poppins', sans-serif; padding: 20px; }
        .back { color: #aaa; text-decoration: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1a1a1a; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #00ff00; }
        input[type="number"] { background: #333; border: none; color: white; padding: 5px; width: 60px; text-align: center; }
        .save-btn { background: #00ff00; color: black; border: none; padding: 5px 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <a href="home.html" class="back">â¬… Dashboard</a>
    <h2 style="color: #00ff00;">LEADERBOARD & POINTS</h2>

    <table>
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Current Score</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="lb-body"></tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyBVwD0U7_QeX8EyOrZ4fm7OG_ow1b391-M", authDomain: "game-f739d.firebaseapp.com", databaseURL: "https://game-f739d-default-rtdb.firebaseio.com", projectId: "game-f739d", storageBucket: "game-f739d.firebasestorage.app", messagingSenderId: "744868437950", appId: "1:744868437950:web:622410843c8aeb229463ef" };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        if(sessionStorage.getItem("admin_logged_in") !== "true") window.location.href = "login.html";

        onValue(ref(db, 'users'), (snap) => {
            const users = [];
            snap.forEach(c => {
                if(c.val().status === 'approved') users.push({ id: c.key, ...c.val() });
            });

            // Sort by Points High to Low
            users.sort((a, b) => (b.points || 0) - (a.points || 0));

            const tbody = document.getElementById('lb-body');
            tbody.innerHTML = '';

            users.forEach((u, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>#${index + 1}</td>
                    <td>${u.name}</td>
                    <td>${u.phone}</td>
                    <td>
                        <input type="number" id="score-${u.id}" value="${u.points || 0}">
                    </td>
                    <td>
                        <button class="save-btn" onclick="updateScore('${u.id}')">SAVE</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });

        window.updateScore = (uid) => {
            const newScore = document.getElementById(`score-${uid}`).value;
            update(ref(db, 'users/' + uid), { points: parseInt(newScore) });
            alert("Score Updated!");
        }
    </script>
</body>
</html>
